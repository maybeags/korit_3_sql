# 입실 체크 해주세요! 🌭

# GROUP BY / HAVING

## GROUP BY - 데이터를 '그룹화'하는 구문
- 같은 값을 가지는 행들(rows)을 하나의 그룹으로 묶어 집계 함수를 적용할 수 있게 함.

## HAVING 
- WHERE은 그룹화 전에 개별 행에 조건을 걸고, _HAVING_은 그룹화 후의 결과에 조건을 걺.

|단계 | 구문 | 의미 |
|---|---|---|
|1 | FROM | 테이블 선택 |
|2 | WHERE | 개별 행 필터링 |
|3 | GROUP BY | 행들을 그룹화 |
|4 | HAVING | 그룹화된 결과 필터링 |
|5 | SELECT | 최종 출력 지정 |
|6 | ORDER BY | 정렬 |

### HAVING은 단독으로 쓸 수 없다. -> GROUP BY에 종속되어있음.
- `HAVING`은 그룹화된 집계 결과에 조건을 거는 방식


문제들

-- 2. 공급 업체별 등록 상품 개수가 3 개 이상인 것만 추출하세요.

-- 3. 공급 업체별 총 재고량이 100개 이상인 것만 추출하세요.

-- 4. 카테고리별 최고 가격이 50000원 초과인 카테고리를 출력하세요.

-- 5. 2024년 2월 이후에 입고된 상품들만 대상으로(WHERE) 공급 업체별 평균 가격이
-- 4만원 이상인 것만 추출하세요.

-- 6. 2024년 2월 이후에 입고된 상품들만 대상으로 카테고리별 평균 가격이
-- 3만원 이하인 것만 추출하세요.

-- 7. 생활가전 카테고리만 대상으로 공급업체별 총 재고가 50개 이상인 것만 추출하세요.

-- 8. TechMart, CleanLife 두 업체만 대상으로 공급 업체별 평균 가격이 20000원
-- 이하인 업체만 출력하세요.


# 풀이 및 현재 전체 코드 20250416 10:42
```sql
SELECT * FROM product_raw;

-- 1. 전체 평균 가격
SELECT AVG(price) AS 평균가격
	FROM product_raw;

-- 2. 가장 재고가 많은 상품의 수량
SELECT MAX(stock) AS 최대수량
	FROM product_raw;

-- Group By
-- 1. 카테고리별 평균 가격
SELECT category, AVG(price) AS 평균가격
	FROM product_raw
	GROUP BY category;

-- 해봤자 소용이 없는 예시 -> 왜? 어차피 각자 고유값을 들고 있기 때문에
SELECT *
	FROM product_raw
	GROUP BY product_id;

SELECT *
	FROM product_raw
	GROUP BY product_name;	-- 혹시나 같은 이름 가지고 있으면 얘는 겹치게 될 수도 있습니다.
	
-- 소용이 있는 예시로,
-- 2. 공급업체별 전체 물량 합을 표시할 것
SELECT supplier, SUM(stock) AS 업체별전체공급량
	FROM product_raw
	GROUP BY supplier
	ORDER BY SUM(stock) DESC;


-- 3. 공급업체별 등록된 상품 개수를 구하세요.
SELECT supplier, COUNT(stock) AS 업체별등록상품개수
	FROM product_raw
	GROUP BY supplier;
-- 4. 공급업체별 평균 재고량을 구하세요.
SELECT supplier, AVG(stock) AS 업체별평균공급량
	FROM product_raw
	GROUP BY supplier;
-- 5. 카테고리별 최저 가격을 구하세요.
SELECT category, MIN(price) AS 카테고리별최저가격
	FROM product_raw
	GROUP BY category;
-- 6. (저랑 풀겁니다) 입고 날짜 기준으로 월별 평균 가격을 구하세요.
SELECT MONTH(created_at) AS 월, AVG(price) AS 평균가격
	FROM product_raw
	GROUP BY MONTH(created_at);
-- GROUP BY 월; -> 이거는 DBMS별로 지원할 수도 있고 아닐 수도 있습니다.

-- HAVING 수업 파트
SELECT supplier, COUNT(stock) AS 업체별등록상품개수
	FROM product_raw
	GROUP BY supplier
	HAVING 업체별등록상품개수 > 1;	-- 얘도 DBMS별로 될 수도 있고 아닐 수도 있음.
-- 	HAVING COUNT(stock) > 1;
	
-- 1. 평균 가격이 4만원 이상인 카테고리만 추출하세요.
SELECT category, AVG(price) AS 평균가격
	FROM product_raw
	GROUP BY category
	HAVING 평균가격 >= 10000;

-- 2. 공급 업체별 등록 상품 개수가 3 개 이상인 것만 추출하세요.
SELECT supplier, COUNT(product_name) AS 상품개수
	FROM product_raw
	GROUP BY supplier
	HAVING 상품개수 >= 3;
-- 3. 공급 업체별 총 재고량이 100개 이상인 업체만 추출하세요.
SELECT supplier, SUM(stock) AS 총재고량
	FROM product_raw
	GROUP BY supplier
	HAVING 총재고량 >= 100
	ORDER BY 총재고량 DESC;
-- 4. 카테고리별 최고 가격이 50000원 초과인 카테고리를 출력하세요.
SELECT category, MAX(price) AS 50000원초과
	FROM product_raw
	GROUP BY category
	HAVING 50000원초과 > 50000;

-- 5. 2024년 2월 이후에 입고된 상품들만 대상으로(WHERE) 공급 업체별 평균 가격이
-- 4만원 이상인 것만 추출하세요.
SELECT supplier, AVG(price) AS 평균가격
	FROM product_raw
	WHERE created_at >= '2024-02-01'
	GROUP BY supplier
	HAVING 평균가격 >= 40000;
-- 6. 2024년 2월 이후에 입고된 상품들만 대상으로 카테고리별 평균 가격이
-- 3만원 이하인 카테고리만 추출하세요.
SELECT category, AVG(price) AS 평균가격
	FROM product_raw
	WHERE created_at >= '2024-02-01'
	GROUP BY category
	HAVING 평균가격 <= 30000;
-- 7. 생활가전 카테고리만 대상으로 공급업체별 총 재고가 50개 이상인 
-- 공급업체만 추출하세요.
SELECT supplier, SUM(stock) AS 총재고
	FROM product_raw
	WHERE category = '생활가전'
	GROUP BY supplier
	HAVING 총재고 >= 50;
-- 8. TechMart, CleanLife 두 업체만 대상으로 공급 업체별 평균 가격이 20000원
-- 이하인 공급업체만 출력하세요.
SELECT supplier, AVG(price) AS 평균가격
	FROM product_raw
	WHERE supplier IN ('TechMart', 'CleanLife')	-- OR 쓰셔도 됩니다.
	GROUP BY supplier
	HAVING 평균가격 <= 20000;
```